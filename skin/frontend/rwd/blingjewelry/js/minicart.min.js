/*
   Copyright (c) 2014 Magento Inc. (http://www.magentocommerce.com)
 @license     http://opensource.org/licenses/afl-3.0.php  Academic Free License (AFL 3.0)
*/
function Minicart(a){this.formKey=a.formKey;this.previousVal=null;this.defaultErrorMessage="Error occurred. Try to refresh page.";this.selectors={itemRemove:"#cart-sidebar .remove",container:"#header-cart",inputQty:".cart-item-quantity",qty:"div.header-minicart span.count",overlay:".minicart-wrapper",error:"#minicart-error-message",success:"#minicart-success-message",quantityButtonPrefix:"#qbutton-",quantityInputPrefix:"#qinput-",quantityButtonClass:".quantity-button"};a.selectors&&$j.extend(this.selectors,
a.selectors)}
Minicart.prototype={init:function(){var a=this;$j(this.selectors.itemRemove).unbind("click.minicart").bind("click.minicart",function(b){b.preventDefault();a.removeItem($j(this))});$j(this.selectors.inputQty).unbind("blur.minicart").unbind("focus.minicart").bind("focus.minicart",function(){a.previousVal=$j(this).val();a.displayQuantityButton($j(this))}).bind("blur.minicart",function(){a.revertInvalidValue(this)});$j(this.selectors.quantityButtonClass).unbind("click.quantity").bind("click.quantity",function(){a.processUpdateQuantity(this)})},
removeItem:function(a){var b=this;confirm(a.data("confirm"))&&(b.hideMessage(),b.showOverlay(),$j.ajax({type:"POST",dataType:"json",data:{form_key:b.formKey},url:a.attr("href")}).done(function(c){b.hideOverlay();c.success?(b.updateCartQty(c.qty),b.updateContentOnRemove(c,a.closest("li"))):b.showMessage(c)}).error(function(){b.hideOverlay();b.showError(b.defaultErrorMessage)}))},revertInvalidValue:function(a){this.isValidQty($j(a).val())&&$j(a).val()!=this.previousVal||($j(a).val(this.previousVal),
this.hideQuantityButton(a))},displayQuantityButton:function(a){a=this.selectors.quantityButtonPrefix+$j(a).data("item-id");$j(a).addClass("visible").attr("disabled",null)},hideQuantityButton:function(a){a=this.selectors.quantityButtonPrefix+$j(a).data("item-id");$j(a).removeClass("visible").attr("disabled","disabled")},processUpdateQuantity:function(a){var b=$j(this.selectors.quantityInputPrefix+$j(a).data("item-id"));this.isValidQty(b.val())&&b.val()!=this.previousVal?this.updateItem(a):this.revertInvalidValue(b)},
updateItem:function(a){var b=this,c=$j(this.selectors.quantityInputPrefix+$j(a).data("item-id")),d=parseInt(c.val(),10);b.hideMessage();b.showOverlay();$j.ajax({type:"POST",dataType:"json",url:c.data("link"),data:{qty:d,form_key:b.formKey}}).done(function(a){b.hideOverlay();a.success?(b.updateCartQty(a.qty),0!==d?b.updateContentOnUpdate(a):b.updateContentOnRemove(a,c.closest("li"))):b.showMessage(a)}).error(function(){b.hideOverlay();b.showError(b.defaultErrorMessage)});return!1},updateContentOnRemove:function(a,
b){var c=this;b.hide("slow",function(){$j(c.selectors.container).html(a.content);c.showMessage(a)})},updateContentOnUpdate:function(a){$j(this.selectors.container).html(a.content);this.showMessage(a)},updateCartQty:function(a){"undefined"!=typeof a&&$j(this.selectors.qty).text(a)},isValidQty:function(a){return 0<a.length&&a-0==a&&0<a-0},showOverlay:function(){$j(this.selectors.overlay).addClass("loading")},hideOverlay:function(){$j(this.selectors.overlay).removeClass("loading")},showMessage:function(a){"undefined"!=
typeof a.notice?this.showError(a.notice):"undefined"!=typeof a.error?this.showError(a.error):"undefined"!=typeof a.message&&this.showSuccess(a.message)},hideMessage:function(){$j(this.selectors.error).fadeOut("slow");$j(this.selectors.success).fadeOut("slow")},showError:function(a){$j(this.selectors.error).text(a).fadeIn("slow")},showSuccess:function(a){$j(this.selectors.success).text(a).fadeIn("slow")}};