<?php
/**
 * Magento Enterprise Edition
 *
 * NOTICE OF LICENSE
 *
 * This source file is subject to the Magento Enterprise Edition License
 * that is bundled with this package in the file LICENSE_EE.txt.
 * It is also available through the world-wide-web at this URL:
 * http://www.magentocommerce.com/license/enterprise-edition
 * If you did not receive a copy of the license and are unable to
 * obtain it through the world-wide-web, please send an email
 * to license@magentocommerce.com so we can send you a copy immediately.
 *
 * DISCLAIMER
 *
 * Do not edit or add to this file if you wish to upgrade Magento to newer
 * versions in the future. If you wish to customize Magento for your
 * needs please refer to http://www.magentocommerce.com for more information.
 *
 * @category    design
 * @package     enterprise_default
 * @copyright   Copyright (c) 2012 Magento Inc. (http://www.magentocommerce.com)
 * @license     http://www.magentocommerce.com/license/enterprise-edition
 */
 /*
 <form action="<?php echo $this->getFormActionUrl() ?>" method="post" id="newsletter-validate-detail">
    <div class="form-subscribe">
    <div class="form-subscribe-header">
        <label for="newsletter"><?php echo $this->__('Sign Up for Our Newsletter:') ?></label>
    </div>
        <div class="v-fix"><input name="email" type="text" id="newsletter" value="<?php echo $this->__('Enter your email address') ?>" onclick="this.value=='<?php echo $this->__('Enter your email address') ?>'?this.value='':''" onblur="this.value==''?this.value='<?php echo $this->__('Enter your email address') ?>':''" class="input-text required-entry validate-email" /></div>
    </div>
</form>
*/
?>
<?php /* WINDOW POPOVER bling code */ ?>
<?php if(!Mage::app()->getStore()->isCurrentlySecure()): ?> 
<div class="modal fade" id="modal-subscribe">
  <div class="modal-dialog">
		<div class="modal-content">
      <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
      <div class="modal-body">
            <div class="block-title">
                <?php echo $this->getLayout()->createBlock('cms/block')->setBlockId('modal_subscribe_header')->toHtml(); ?>
            </div>
            <!--action="<?php echo $this->getFormActionUrl() ?>"-->
            <div class="block-subscribe">
              
            <form action="http://app.bronto.com/public/webform/process/" method="post" id="newsletter-validate-detail" onsubmit="_gaq.push(['_trackEvent','Form','Submitted','Welcome Email'])">
                <input type="hidden" name="fid" value="k3zv84ptgddc8azmc9wq1324913v9">
                <input type="hidden" name="sid" value="7dedefd9cabbee54575f59e89030c2fa">
                <input type="hidden" name="delid" value="">
                <input type="hidden" name="subid" value="">
                <input type="hidden" name="td" value="">
                <input type="hidden" name="formtype" value="addcontact">
                <div class="block-content">
                    <div class="input-box">
                    <input type="text" name="84585" id="newsletter" title="Sign up for our newsletter" class="input-text required-entry validate-email"  value='<?php echo $this->__('Your email') ?>' onfocus="if (this.value == '<?php echo $this->__('Your email') ?>') this.value = '';" onblur="if (this.value == '') this.value = '<?php echo $this->__('Your email') ?>';">
                     <label for="newsletter"><?php echo $this->getLayout()->createBlock('cms/block')->setBlockId('footer_newsletter_privacy')->toHtml(); ?></label>
                    </div>
                  	<!--<button class="btn" type="button"><i class="icon-caret-right"></i></button>-->
                  	 <div class="actions">
                	     <button type="submit" onclick="subscribePop()" title="<?php echo Mage::helper('contacts')->__('Submit') ?>" class="button">Join</button>
                	   </div>
                </div>
                <div id="subscribe-pop-loader" class="subscribe-msg" style="display:none">Sending...</div>
                <div id="subscribe-pop-success" class="subscribe-msg" style="display:none">Thank you!</div>
              </form>

            </div>
            <?php if(Mage::getModel('cms/block')->load('modal_subscribe_footer')->getIsActive()):?>
            <div class="block-footer std">
              <?php echo $this->getLayout()->createBlock('cms/block')->setBlockId('modal_subscribe_footer')->toHtml(); ?>
            </div>
            <?php endif;?>

      </div><!-- /.modal-body -->
    </div><!-- /.modal-content -->
  </div><!-- /.modal-dialog -->
</div><!-- /.modal -->


<script type="text/javascript">
//<![CDATA[
/* bling disable
	var newsletterPopFormDetail = new VarienForm('newsletter-pop');
    function subscribePop(){ 
            if (newsletterPopFormDetail.validator.validate()) {
             	new Ajax.Updater(
             			{success:'newsletterPopFormDetail'},'/newsletter/subscriber/new', 
             			{
             				method:'post', 
             				action:"/newsletter/subscriber/new", 
             				asynchronous:true, 
             				evalScripts:false, 
             				onComplete:function(request, json){
             					Element.hide('subscribe-pop-loader');
             					Element.show('subscribe-pop-success');
             					setTimeout("fadeoutPop()",1000)
             					document.getElementById('newsletter-pop').reset();
             				}, 
             				onLoading:function(request, json){
             					Element.show('subscribe-pop-loader')
             				}, 
             				parameters:Form.serialize($('newsletter-pop'))
             			});
             }else{
             	var elem = document.getElementById("newsletterPop");
				elem.value = "Valid email please";
             }
       }
       
       // fade out after submission
       function fadeoutPop(){
       		new Effect.Fade('subscribe-pop-success');
       		setTimeout(function(){
       			jQuery("#modal-subscribe").modal('hide');
       			},2000);
       }
*/
      /* mmc orig js based cookie functionality replaced by localstorage or orig bling code
      var sub = readCookie('subscribePop');
        if(!sub){
          jQuery(document).ready(function() {
          setTimeout(function() {jQuery("#modal-subscribe").modal('show');}, 3000);
          createCookie('subscribePop',1,3);
        });
      }
      
      // create/read cookie functions
      function createCookie(name,value,days) {
        if (days) {
              var date = new Date();
              date.setTime(date.getTime()+(days*24*60*60*1000));
              var expires = "; expires="+date.toGMTString();
        }
        else var expires = "";
        document.cookie = name+"="+value+expires+"; path=/";
      }

      function readCookie(name) {
        var nameEQ = name + "=";
        var ca = document.cookie.split(';');
        for(var i=0;i < ca.length;i++) {
              var c = ca[i];
              while (c.charAt(0)==' ') c = c.substring(1,c.length);
              if (c.indexOf(nameEQ) == 0) return c.substring(nameEQ.length,c.length);
        }
        return null;
      }
      */
    
      /* localstorage logic
      if (window.location.protocol != "https:"){
        if (Modernizr.localstorage) {
          // use local storage to show pop up only once
          if (localStorage.getItem("subpop") === null) {
            setTimeout(function() {jQuery("#modal-subscribe").modal('show');}, 3000);
            localStorage.setItem('subpop', 1);
          }
        } else {
            // javascript fallback - not in use.
            //var sub = readCookie('subscribePop');
        		//if(!sub){
        		//	jQuery(document).ready(function() {
            //    setTimeout(function() {jQuery("#modal-subscribe").modal('show');}, 3000);
        		//		createCookie('subscribePop',1,3);
        		//	});
        		//}
        }
      }
      */
      //for testing 
      //setTimeout(function() {jQuery("#modal-subscribe").modal('show');}, 3000);
//]]>
</script>



<script type="text/javascript">
window.onload = checkVisit;

function setCookie(name, value, expires, path, domain, secure) {
  document.cookie = name + "=" + escape(value) +
    ((expires) ? "; expires=" + expires.toGMTString() : "") +
    ((path) ? "; path=" + path : "") +
    ((domain) ? "; domain=" + domain : "") +
    ((secure) ? "; secure" : "");
}
function getCookie(name) {
  var dc = document.cookie;
  var prefix = name + "=";
  var begin = dc.indexOf("; " + prefix);
  if (begin == -1) {
    begin = dc.indexOf(prefix);
    if (begin != 0) return null;
  } else {
    begin += 2;
  }
  var end = document.cookie.indexOf(";", begin);
  if (end == -1) {
    end = dc.length;
  }
  return unescape(dc.substring(begin + prefix.length, end));
}
function checkVisit() {
  // Check last viewed version
  var cookie = getCookie("javawin");
  if (cookie == null || parseFloat(cookie) < 1.31) {
    //Windows.overlayHideEffectOptions = {duration: 0.3, delay: 0.3},
    date = new Date;
    //date.setMonth(date.getMonth()+1); //for one month
    date.setDate(date.getDate()+1);
    setCookie("javawin", "1.31", date);
    showModal();
  }
}
function showModal() {
  /* old bling code
  Dialog.alert({url: "http://www.blingjewelry.com/subscribe.html", options: {method: 'get'}},  
               {className: "greylighting", width:338, okLabel: "X", 
               showEffect: Effect.ModalSlideDown, hideEffect: Effect.ModalSlideUp,showEffectOptions: {duration: 0.7}, hideEffectOptions: {duration: 0.3}});
*/
  setTimeout(function() {jQuery("#modal-subscribe").modal('show');}, 3000);
  _gaq.push(['_trackPageview', '/subscribe.html']);
}
</script>
<?php endif ;?>